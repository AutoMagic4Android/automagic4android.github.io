<!doctype html>

<html lang="en">
	<head>
	  <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

	  <title>AutoMagic4Android</title>
	  <meta name="description" content="Auto Magic For Android">
	  <meta name="author" content="Bluscream">

	  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>

	  <!--[if lt IE 9]>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
	  <![endif]-->
	</head>
	<body linkifying="true" style="color:#999999;background-color:#3b3b3b">
		<img align="right" src="https://automagic4android.com/images/automagic_title_587.png"/>
		<!--h1>Flow Info</h1-->
		<h3 id="loading">Loading...</h3>
		<h2>Flows</h2>
		<table id="flows" border="1">
			<tr>
				<th>Enabled</th>
				<th>Group</th>
				<th>Name</th>
				<th>Execution Policy</th>
			</tr>
		</table><br>
		<h2>Triggers</h2>
		<table id="triggers" border="1">
			<tr>
				<th>Enabled</th>
				<th>Type</th>
				<th>Name</th>
				<th>Method</th>
				<th>Package Name Filter</th>
				<th>Class Name Filter</th>
				<th>Use Default Name</th>
			</tr>
		</table><br>
		<h2>Conditions</h2>
		<table id="conditions" border="1">
			<tr>
				<th>Type</th>
				<th>Name</th>
				<th>Expression</th>
				<th>Use Default Name</th>
			</tr>
		</table><br>
		<h2>Actions</h2>
		<table id="actions" border="1">
			<tr>
				<th>Type</th>
				<th>Name</th>
			</tr>
		</table><br>
		<script type="text/javascript">
			function parseInfo(flow) {
				$(flow).find('flow').each(function(){
					_row = $("<tr />");
		            _row.append("<td>"+$(this).find("enabled").text()+"</td>");
		            _row.append("<td>"+$(this).find("group").text()+"</td>");
		            _row.append("<td>"+$(this).find("name").text()+"</td>");
		            _row.append("<td>"+$(this).find("executionPolicy").text()+"</td>");
		            $("#flows").append(_row);
				});
			}
			function parseTriggers(flow) {
				$(flow).find('trigger').each(function(){
					_row = $("<tr />");
		            _row.append("<td>"+$(this).find("enabled").text()+"</td>");
		            //_row.append("<td>"+$(this).find("group").text()+"</td>"); type
		            _row.append("<td>"+$(this).find("name").text()+"</td>");
		            _row.append("<td>"+$(this).find("method").text()+"</td>");
		            _row.append("<td>"+$(this).find("packageNameFilter").text()+"</td>");
		            _row.append("<td>"+$(this).find("classNameFilter").text()+"</td>");
		            _row.append("<td>"+$(this).find("useDefaultName").text()+"</td>");
		            $("#triggers").append(_row);
				});
			}
			$(document).ready(function () {
				$.ajax({
				    type: "GET",
				    url: "https://cors-anywhere.herokuapp.com/"+window["location"]["href"].split(/#(.+)/)[1],
				    cache: false,
				    dataType: "xml",
				    success: function(flow) {
				    	console.log(flow);
				    	console.log('---')
				        parseInfo(flow);
				        parseTriggers(flow);
				    	$("#loading").text("Created with AutoMagic For Android v"+flow.documentElement.getAttribute("version"));
				    }
				});
			});
			/*function loadDoc() {
			  var xhttp = new XMLHttpRequest();
			  xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
				myFunction(this);
				}
			  };
			  xhttp.open("GET", "https://cors-anywhere.herokuapp.com/"+window["location"]["href"].split(/#(.+)/)[1], true);
			  xhttp.send();
			}
			function myFunction(xml) {
			  var i;
			  document.getElementById("result").innerHTML = xml.responseText
			  var xmlDoc = xml.responseXML;
			  var table="<tr><th>Title</th><th>Artist</th></tr>";
			  var x = xmlDoc.getElementsByTagName("CD");
			  for (i = 0; i <x.length; i++) {
				table += "<tr><td>" +
				x[i].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue +
				"</td><td>" +
				x[i].getElementsByTagName("ARTIST")[0].childNodes[0].nodeValue +
				"</td></tr>";
			  }
			  document.getElementById("result").innerHTML = table;
			  
			}
			loadDoc()*/
			/*$.ajax({
				type: "get",
				url: "https://cors-anywhere.herokuapp.com/" + window["location"]["href"].split(/#(.+)/)[1],
				dataType: "xml",
				success: function(data) {
					$("#loading").remove();
					console.log(data);
					console.log("Finished loading flow...");
					//flow = $.parseXML(data);
					if (window.DOMParser)
					{
						parser = new DOMParser();
						xmlDoc = parser.parseFromString(data, "text/xml");
					}
					else // Internet Explorer
					{
						xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
						xmlDoc.async = false;
						xmlDoc.loadXML(data);
					}
					xmlDoc = data;
					console.log(flow)
					$("#result").html(flow["flow"]["name"]);
				},
				error: function(xhr, status) {
					$("#loading").html(status);
				}
			});*/
		</script>
	</body>
</html>
